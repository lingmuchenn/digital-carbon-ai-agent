# 数字脱碳AI Agent

本项目是一款基于 AI 与语义理解的文件深度分析与整理工具，旨在帮助用户高效清理冗余文件、识别相似文档、并对海量图片进行智能分类与质量评估。项目采用 Python 开发，集成多种大模型能力，并提供流畅的桌面交互体验。

## 🎯 产品设计初衷

针对个人用户在学习、工作场景中高频产生的“桌面杂乱”、“文件夹堆积”问题，本产品定位于**轻量级文件数字化管家**。
*   **高频场景优化**：专注于下载文件夹、项目过程目录、图片库等极易产生冗余的场景。
*   **极简交互 (Floating Ball)**：创新采用**悬浮球** UI 设计，平时静默悬浮于桌面边缘，支持随时通过拖拽文件夹触发分析，将繁琐的清理任务转化为即时、轻量的交互体验。

## 🛠️ 核心功能模块

### 1. 现状：已上线的双引擎
*   **重复文件 (Exact Match)**：基于 MD5 哈希的“内容查重”，精准识别并清理字节级一致的无用副本。
*   **相似文件 (AI Semantic)**：引入大模型语义理解，识别“文稿改版”、“多版本草稿”、“长相雷同的连拍照片”，提供智能保留建议。

### 2. 未来：进阶中的数字化管家
*   **历史文件 (Version Archive)**：*（开发中）* 旨在通过时间线回溯，自动识别并归档长周期的历史遗留文档，让文件夹告别“2023旧版”、“2024最终版”的混乱。
*   **过程文件 (Workflow Cleanup)**：*（开发中）* 专注于识别项目运行中产生的临时缓存、中间编译结果、临时截图，实现“工作完、目录净”的自动化整理逻辑。

## 🎨 前端交互与流程逻辑

产品采用**向导式 (Step-by-Step)** 的交互逻辑，确保即使是复杂的 AI 分析流程也能清晰透明地呈现给用户：

1.  **Step 1: 扫描与预估 (Scan & Estimate)**  
    用户拖入文件夹后，系统进行快速索引。利用轻量化算法预估 AI 分析所需时长，通过动态进度条缓解用户的“黑盒等待”焦虑。
2.  **Step 2: 多维分析 (Multi-dim Analysis)**  
    后端调度 Hash、Embedding、VL 等多个链路并发处理。前端实时滚动展示“AI 正在思考”的日志流，增强产品的技术感与信任度。
3.  **Step 3: 智能决策预览 (Review & Decision)**  
    分析完成后，系统按“重复、相似、建议清理”等维度展示卡片式结果。每组结果均提供 AI 编写的“差异说明”，帮助用户在毫秒间做出删除或保留的选择。
4.  **Step 4: 一键整理 (Batch Action)**  
    用户确认后，系统执行批量移动至回收站的操作。支持操作撤回，确保文件处理的安全边际。

## 🚀 技术栈

*   **后端**: Python 3.11+, Flask
*   **AI 模型**:
    *   **文本嵌入**: DashScope (text-embedding-v3/v4)
    *   **视觉理解/OCR**: Qwen-VL (qwen-vl-plus/qwen3-vl-plus)
    *   **语义分析**: DeepSeek-V3 / DeepSeek-R1
*   **计算机视觉**: OpenCV, Pillow, numpy
*   **文档处理**: PyPDF2, pypdfium2, python-docx
*   **前端**: 原生 JS + CSS (Figma 风格 UI), pywebview (桌面容器)


## 🌟 项目亮点

*   **智能兜底策略**：在 PDF 解析中，优先使用文本提取，若提取内容不足则自动触发 VL 模型的 OCR。
*   **多维相似度评价**：照片去重结合了 pHash (感知哈希)、HSV 直方图、语义 Embedding 及视觉描述相似度。
*   **轻量化向量化**：针对长文档采用分块 (Chunking) 策略计算加权平均 Embedding，解决大模型 Token 限制。

## 🛠️ 技术链路详述

### 1. 完全重复文件链路 (Hash-based)
*   **扫描策略**：首先按文件大小 (Size) 进行快速分组，仅对大小一致的文件计算 MD5 哈希，大幅减少磁盘 I/O 开销。
*   **决策逻辑**：优先保留最近访问时间 (`atime`) 最晚的文件；若访问时间一致，则参考创建时间 (`ctime`)，确保保留最活跃的副本。

### 2. 相似文档识别链路 (Semantic-based)
*   **多阶处理**：
    1.  **提取层**：优先进行文本流提取；若识别为图片型 PDF 或文本量极少（<80字符），自动触发 **Qwen-VL OCR** 补全内容。
    2.  **初筛层**：利用 Jaccard 相似度与字符重叠率进行快速粗排，剔除完全不相关的文件对。
    3.  **语义层**：对长文本进行分块 (Chunking) 并计算加权平均 Embedding，通过 **Cosine Similarity** 判定语义相似度。
    4.  **生成层**：调用 **DeepSeek-V3** 动态对比两份文档的差异，输出结构化的“相同点”与“独有内容”报告。

### 3. 智能图像处理链路 (Vision-based)
*   **视觉分类**：利用多模态模型判断图片属性，将其切分为“真实照片”与“非照片（截图/文档）”两条子链路。
*   **照片子链路 (BestShot)**：
    1.  **特征融合**：结合 **pHash (感知哈希)**、**HSV 直方图**、**视觉标签** 及 **Embedding** 进行多模态相似度聚类。
    2.  **质量评估**：从清晰度 (Laplacian Variance)、曝光合理度、亮度分布及构图得分四个维度计算 **BestShot Score**。
    3.  **择优保留**：在每一个相似簇中，自动标记分值最高的照片为“保留”，其余为“相似删除”。
*   **截图子链路 (LLM Classify)**：
    1.  **四分类模型**：由 LLM 根据视觉描述将其归类为临时类 (Temporary)、参考类 (Reference)、收藏类 (Saved) 或记忆类 (Memory)。
    2.  **杂乱度评估**：识别界面中的弹窗、通知等冗余元素，优先保留画面最“干净”的版本。

---
本工具适用于开发者、AI 产品经理及需要管理大量杂乱文件的个人用户。

